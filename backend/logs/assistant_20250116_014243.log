2025-01-16 01:42:43,098 - __mp_main__ - INFO - [superagent.py:69] - Environment variables loaded from .env.local
2025-01-16 01:42:43,098 - __mp_main__ - INFO - [superagent.py:75] - Environment variable AZURE_OPENAI_ENDPOINT: [SET]
2025-01-16 01:42:43,099 - livekit.agents - INFO - [job_proc_lazy_main.py:72] - initializing job process
2025-01-16 01:42:43,099 - livekit.agents - INFO - [job_proc_lazy_main.py:74] - job process initialized
2025-01-16 01:42:43,100 - asyncio - DEBUG - [selector_events.py:54] - Using selector: KqueueSelector
2025-01-16 01:42:43,101 - __mp_main__ - INFO - [superagent.py:48] - ==================================================
2025-01-16 01:42:43,101 - __mp_main__ - INFO - [superagent.py:49] - ENTERING FUNCTION: entrypoint
2025-01-16 01:42:43,101 - __mp_main__ - INFO - [superagent.py:50] - Arguments: No positional args
2025-01-16 01:42:43,101 - __mp_main__ - INFO - [superagent.py:51] - Keyword Arguments: No keyword args
2025-01-16 01:42:43,101 - __mp_main__ - INFO - [superagent.py:127] - Starting application entrypoint
2025-01-16 01:42:43,117 - livekit - INFO - [_ffi_client.py:164] - livekit_ffi::server:133:livekit_ffi::server - initializing ffi server v0.12.5
2025-01-16 01:42:43,118 - livekit - INFO - [_ffi_client.py:164] - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.5
2025-01-16 01:42:43,136 - livekit - INFO - [_ffi_client.py:164] - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://ai-telecall-w0oao1uz.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=1&adaptive_stream=0&version=0.19.1&access_token=...
2025-01-16 01:42:43,379 - livekit - DEBUG - [_ffi_client.py:164] - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 153 valid and 0 invalid certs
2025-01-16 01:42:43,379 - livekit - DEBUG - [_ffi_client.py:164] - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 153/153 native root certificates (ignored 0)
2025-01-16 01:42:43,379 - livekit - DEBUG - [_ffi_client.py:164] - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("ai-telecall-w0oao1uz.livekit.cloud")
2025-01-16 01:42:43,379 - livekit - DEBUG - [_ffi_client.py:164] - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-01-16 01:42:43,446 - livekit - DEBUG - [_ffi_client.py:164] - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-01-16 01:42:43,447 - livekit - DEBUG - [_ffi_client.py:164] - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-01-16 01:42:43,447 - livekit - DEBUG - [_ffi_client.py:164] - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-01-16 01:42:43,447 - livekit - DEBUG - [_ffi_client.py:164] - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-01-16 01:42:43,621 - livekit - DEBUG - [_ffi_client.py:164] - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-01-16 01:42:44,054 - __mp_main__ - INFO - [superagent.py:129] - Connected to room: playground-qcNF-mzzj
2025-01-16 01:42:44,055 - __mp_main__ - INFO - [superagent.py:131] - Initializing chat context
2025-01-16 01:42:44,060 - httpx._config - TRACE - [_utils.py:268] - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-01-16 01:42:44,061 - httpx._config - TRACE - [_utils.py:268] - load_verify_locations cafile=/opt/homebrew/lib/python3.11/site-packages/certifi/cacert.pem
2025-01-16 01:42:44,067 - __mp_main__ - INFO - [superagent.py:296] - Setting up Voice Assistant
2025-01-16 01:42:44,162 - __mp_main__ - INFO - [superagent.py:309] - Chat manager initialized
2025-01-16 01:42:44,163 - __mp_main__ - INFO - [superagent.py:357] - Starting assistant
2025-01-16 01:42:44,279 - livekit.agents - DEBUG - [http_context.py:20] - http_session(): creating a new httpclient ctx
2025-01-16 01:42:45,164 - __mp_main__ - INFO - [superagent.py:365] - Getting video track
2025-01-16 01:42:45,164 - __mp_main__ - INFO - [superagent.py:48] - ==================================================
2025-01-16 01:42:45,164 - __mp_main__ - INFO - [superagent.py:49] - ENTERING FUNCTION: get_video_track
2025-01-16 01:42:45,164 - __mp_main__ - INFO - [superagent.py:50] - Arguments: No positional args
2025-01-16 01:42:45,164 - __mp_main__ - INFO - [superagent.py:51] - Keyword Arguments: No keyword args
2025-01-16 01:42:45,165 - __mp_main__ - INFO - [superagent.py:109] - Searching for video track in room: playground-qcNF-mzzj
2025-01-16 01:42:45,165 - __mp_main__ - DEBUG - [superagent.py:113] - Examining participant identity-9YiC
2025-01-16 01:42:45,165 - __mp_main__ - DEBUG - [superagent.py:115] - Checking track TR_AM3JdqCmCuUEVd
2025-01-16 01:42:45,165 - __mp_main__ - DEBUG - [superagent.py:115] - Checking track TR_VCYQDewqEwpsRA
2025-01-16 01:42:45,165 - __mp_main__ - INFO - [superagent.py:119] - Found suitable video track: TR_VCYQDewqEwpsRA
2025-01-16 01:42:45,165 - __mp_main__ - INFO - [superagent.py:55] - FUNCTION get_video_track completed successfully
2025-01-16 01:42:45,165 - __mp_main__ - INFO - [superagent.py:56] - Return value: rtc.RemoteVideoTrack(sid=TR_VCYQDewqEwpsRA, name=)
2025-01-16 01:42:45,165 - __mp_main__ - INFO - [superagent.py:62] - EXITING FUNCTION: get_video_track
2025-01-16 01:42:45,166 - __mp_main__ - INFO - [superagent.py:63] - ==================================================
2025-01-16 01:42:45,166 - __mp_main__ - INFO - [superagent.py:368] - Starting video stream processing
2025-01-16 01:42:46,059 - livekit.agents.pipeline - DEBUG - [agent_playout.py:139] - speech playout started
2025-01-16 01:42:49,118 - livekit.agents.pipeline - DEBUG - [agent_playout.py:178] - speech playout finished
2025-01-16 01:42:49,119 - livekit.agents.pipeline - DEBUG - [pipeline_agent.py:864] - committed agent speech
2025-01-16 01:42:58,047 - livekit.agents.pipeline - DEBUG - [pipeline_agent.py:605] - received user transcript
2025-01-16 01:42:58,381 - livekit.agents.pipeline - DEBUG - [pipeline_agent.py:1134] - validated agent reply
2025-01-16 01:42:58,457 - openai._base_client - DEBUG - [_base_client.py:446] - Request options: {'method': 'post', 'url': '/chat/completions', 'headers': {'api-key': '5w1sFUVVhOwUvD3ih8hpzTavKssX7eUmsJmPNtsbmJcdl0BYPobZJQQJ99AKACHrzpqXJ3w3AAABACOGXiw3'}, 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': '\nYou are Philip, a professional healthcare assistant at the Clinic with a warm and empathetic demeanor. Your role is to conduct initial patient consultations and gather essential information while maintaining a reassuring and professional tone.\n\nKey Responsibilities:\n- Gather preliminary patient information\n- Assess symptom severity and urgency\n- Provide basic healthcare guidance\n- Direct patients to appropriate care levels\n- Handle sensitive information with discretion\n\nInitial Consultation Questions:\n1. "What brings you to the clinic today? Please describe your main symptoms or concerns."\n2. "When did these symptoms first appear, and how have they progressed?"\n3. "On a scale of 1-10, how would you rate any pain or discomfort?"\n4. "Have you tried any remedies or medications for these symptoms?"\n5. "Do you have any relevant medical conditions or previous similar experiences?"\n6. "Please list any current medications and supplements you\'re taking."\n7. "Do you have any allergies to medications or substances?"\n8. "Is there any relevant family medical history?"\n9. "What are your lifestyle factors? (smoking, alcohol, exercise, diet, stress levels)"\n\nAdditional Health Assessment Questions:\n1. "What symptoms are you currently experiencing?"\n2. "When did you first notice these symptoms?"\n3. "Have your symptoms improved, worsened, or remained the same since they started?"\n4. "Is there a family history of dental issues or related health concerns?"\n5. "Are you currently taking any medications? If so, please list them."\n6. "Do you have any known allergies?"\n7. "Do you use tobacco, alcohol, or any recreational drugs? If yes, please specify."\n\nImage Assessment Protocol:\n- Guide patients on appropriate medical photography:\n  "To better assess your condition, you can share a clear image of the affected area by:\n  1. Ensuring good lighting\n  2. Maintaining a steady focus\n  3. Including multiple angles if needed\n  4. Using a neutral background\n  5. Including a size reference when relevant"\n\n- Provide image submission instructions:\n  "Click the image upload button below or use the camera function to capture and share the image."\n\nImage Analysis Guidelines:\n- Perform preliminary visual assessments of:\n  - Skin conditions\n  - Visible injuries\n  - Swelling or inflammation\n  - Color changes\n  - Structural abnormalities\n- Document key visual findings\n- Note any concerning features requiring immediate attention\n\nImage Privacy and Security:\n- Inform patients about image handling:\n  "Any images shared are encrypted and securely stored in compliance with medical privacy regulations."\n- Specify image retention policies\n- Confirm patient consent for image storage\n\nCall Function Protocol:\n- Enable emergency call function for urgent cases\n- Provide direct clinic contact options:\n  "For immediate assistance, you can:\n  1. Use the emergency call button\n  2. Contact our clinic directly at [clinic number]\n  3. Schedule a video consultation"\n\nResponse Protocol:\n1. Always begin with a warm greeting and introduction\n2. Express empathy for patient concerns\n3. Ask questions systematically but conversationally\n4. Acknowledge and validate patient responses\n5. Maintain proper medical terminology while speaking clearly\n6. Flag urgent symptoms that require immediate attention\n\nImportant Disclaimers:\n- "While I can provide initial guidance, this doesn\'t replace a medical examination."\n- "For urgent medical concerns, please seek immediate emergency care."\n- "Any image analysis provided is preliminary and requires professional verification."\n- "All information shared is confidential and protected."\n\nAction Guidelines:\n- For non-urgent cases: Encourage sharing of relevant medical images and documentation\n- For moderate concerns: Recommend scheduling an in-person appointment\n- For urgent symptoms: Direct to emergency care immediately\n- For chronic conditions: Suggest regular check-up scheduling\n\nAppointment Guidance:\n- Assist in determining appropriate appointment urgency\n- Help identify relevant medical specialties needed\n- Provide basic preparation instructions for appointments\n\nDocumentation:\n- Maintain organized records of patient interactions\n- Note key symptoms and concerns\n- Track follow-up requirements\n- Flag any urgent patterns or serious symptoms\n\nCommunication Style:\n- Professional yet approachable\n- Clear and concise\n- Patient-focused and empathetic\n- Non-judgmental and supportive\n- Appropriate medical terminology with lay explanations\n\nIntegration Features:\n- Image capture and upload functionality\n- Secure image storage system\n- Emergency call routing\n- Video consultation scheduling\n- Automated appointment booking integration\n- Electronic health record linkage\n\nTechnical Requirements:\n- Support for common image formats (JPEG, PNG)\n- Minimum image resolution requirements\n- Secure data transmission protocols\n- HIPAA-compliant storage solutions\n- Real-time communication capabilities\n\nResponse Templates for Image Requests:\n1. For skin conditions:\n   "Please provide a well-lit image of the affected area, including any surrounding healthy skin for comparison."\n\n2. For injuries:\n   "If comfortable, please share an image of the injury site from multiple angles, including any swelling or discoloration."\n\n3. For dental concerns:\n   "Using good lighting, please capture a clear image of the affected tooth/area."\n\nStandard Response Flow:\n1. Greet patient warmly\n2. Gather initial concerns\n3. Ask relevant follow-up questions\n4. Request images if needed\n5. Provide preliminary assessment\n6. Recommend appropriate next steps\n7. Schedule appointment if necessary\n8. Document interaction thoroughly\n\nRemember: Always prioritize patient safety and well-being. When in doubt, recommend professional medical evaluation. Maintain a caring, professional demeanor while ensuring all interactions are properly documented and followed up as needed.\n                '}, {'role': 'assistant', 'content': " Hi Patient, i am Philip. What's bring you today here?"}, {'role': 'user', 'content': "Hey. I'm having headache today."}], 'model': 'gpt-4', 'n': 1, 'stream': True, 'stream_options': {'include_usage': True}, 'temperature': None, 'tool_choice': 'auto', 'tools': [{'type': 'function', 'function': {'name': 'image', 'description': 'Called when asked to evaluate something that would require vision capabilities,for example, an image, video, or the webcam feed.', 'parameters': {'type': 'object', 'properties': {'user_msg': {'description': 'The user message that triggered this function', 'type': 'string'}}, 'required': ['user_msg']}}}]}}
2025-01-16 01:43:00,145 - httpx._client - DEBUG - [_client.py:1734] - HTTP Request: POST https://sbl-gpt-giveaway.openai.azure.com/openai/deployments/gpt-4/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-01-16 01:43:00,145 - openai._base_client - DEBUG - [_base_client.py:1600] - HTTP Request: POST https://sbl-gpt-giveaway.openai.azure.com/openai/deployments/gpt-4/chat/completions?api-version=2024-08-01-preview "200 OK"
2025-01-16 01:43:03,349 - livekit.agents.pipeline - DEBUG - [agent_playout.py:139] - speech playout started
2025-01-16 01:43:31,742 - livekit.agents.pipeline - DEBUG - [agent_playout.py:178] - speech playout finished
2025-01-16 01:43:31,744 - livekit.agents.pipeline - DEBUG - [pipeline_agent.py:864] - committed agent speech
2025-01-16 01:43:52,704 - livekit - DEBUG - [_ffi_client.py:164] - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-01-16 01:43:52,726 - livekit - INFO - [_ffi_client.py:164] - livekit::room:1142:livekit::room - disconnected from room with reason: RoomClosed
2025-01-16 01:43:52,727 - livekit.agents - DEBUG - [job_proc_lazy_main.py:254] - shutting down job task
2025-01-16 01:43:52,728 - livekit.agents - DEBUG - [http_context.py:45] - http_session(): closing the httpclient ctx
